{"version":3,"sources":["../../../../src/app/doctor/page.tsx","../../../../node_modules/lucide-react/src/icons/external-link.ts","../../../../node_modules/lucide-react/src/icons/printer.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { Staff, Visit, Medication, Service } from '@/types';\r\nimport { Search, Users, Stethoscope, Beaker, FileText, CheckCircle, XCircle, Printer, Save, History, Plus, ExternalLink } from 'lucide-react';\r\nimport PatientHistoryModal from '@/components/PatientHistoryModal';\r\nimport QueueList from '@/components/QueueList';\r\n\r\nexport default function DoctorPage() {\r\n    const [doctors, setDoctors] = useState<Staff[]>([]);\r\n    const [selectedDoctor, setSelectedDoctor] = useState<string>('');\r\n    const [prescriptions, setPrescriptions] = useState<{ name: string, dose: string, qty: string }[]>([]);\r\n    const [activeVisit, setActiveVisit] = useState<Visit | null>(null);\r\n    const [examNote, setExamNote] = useState({ reason: '', conclusion: '' });\r\n    const [pendingServices, setPendingServices] = useState<string[]>([]);\r\n    const [completedServices, setCompletedServices] = useState<Service[]>([]);\r\n    const [availableMedications, setAvailableMedications] = useState<Medication[]>([]);\r\n    const [availableServices, setAvailableServices] = useState<string[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [message, setMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null);\r\n    const [showHistory, setShowHistory] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchDoctors();\r\n        fetchMedications();\r\n        fetchServices();\r\n    }, []);\r\n\r\n    async function fetchServices() {\r\n        // Fetch active services, excluding 'Khám bệnh' which is a base fee\r\n        const { data } = await supabase\r\n            .from('service_catalog')\r\n            .select('name')\r\n            .eq('is_active', true)\r\n            .neq('name', 'Khám bệnh')\r\n            .order('name');\r\n\r\n        if (data) {\r\n            setAvailableServices(data.map(s => s.name));\r\n        }\r\n    }\r\n\r\n    async function fetchDoctors() {\r\n        const { data } = await supabase.from('staff').select('*').eq('role', 'Doctor').eq('is_active', true);\r\n        if (data) setDoctors(data);\r\n    }\r\n\r\n    // Auto-restore session when doctor is selected\r\n    useEffect(() => {\r\n        if (!selectedDoctor) return;\r\n        restoreActiveSession();\r\n    }, [selectedDoctor]);\r\n\r\n    async function restoreActiveSession() {\r\n        // Find any visit that is currently 'Examing' by this doctor\r\n        const { data } = await supabase\r\n            .from('visits')\r\n            .select(`*, patient:patients(*)`)\r\n            .eq('doctor_by', selectedDoctor)\r\n            .eq('status', 'Examing');\r\n\r\n        if (data && data.length === 1) {\r\n            // Only auto-restore if exactly one found. If multiple, let them choose from the \"Examing\" list.\r\n            handleSelectPatient(data[0]);\r\n            setMessage({ type: 'success', text: `Đã khôi phục phiên khám của ${data[0].patient?.full_name}` });\r\n        } else if (data && data.length > 1) {\r\n            setMessage({ type: 'success', text: `Đang có ${data.length} bệnh nhân đang khám dở. Vui lòng chọn từ danh sách.` });\r\n        }\r\n    }\r\n\r\n    async function fetchMedications() {\r\n        // Try fetching active meds\r\n        let { data, error } = await supabase\r\n            .from('medications')\r\n            .select('*')\r\n            .eq('is_active', true)\r\n            .order('name');\r\n\r\n        if (error) {\r\n            console.error('Error fetching active meds, trying all...', error);\r\n            // Fallback: If 'is_active' column missing, fetch all\r\n            const res = await supabase.from('medications').select('*').order('name');\r\n            data = res.data;\r\n        }\r\n\r\n        if (data) setAvailableMedications(data);\r\n    }\r\n\r\n    async function handleSelectPatient(visit: Visit) {\r\n        if (!selectedDoctor) {\r\n            setMessage({ type: 'error', text: 'Vui lòng chọn Tên Bác sĩ trước khi gọi bệnh nhân!' });\r\n            return;\r\n        }\r\n\r\n        setActiveVisit(visit);\r\n        setExamNote({ reason: visit.reason || '', conclusion: visit.conclusion || '' });\r\n        setPendingServices([]);\r\n\r\n        // Fetch existing prescriptions if any\r\n        const { data: prescriptionData } = await supabase.from('prescriptions').select('*').eq('visit_id', visit.id).single();\r\n        if (prescriptionData) setPrescriptions(prescriptionData.medication_data);\r\n        else setPrescriptions([]);\r\n\r\n        // Fetch completed services\r\n        const { data: servicesData } = await supabase\r\n            .from('services')\r\n            .select('*')\r\n            .eq('visit_id', visit.id)\r\n            .in('status', ['Completed', 'Skipped']);\r\n\r\n        if (servicesData) setCompletedServices(servicesData);\r\n        else setCompletedServices([]);\r\n\r\n        // Update visit status to 'Examing'\r\n        await supabase.from('visits').update({ status: 'Examing', doctor_by: selectedDoctor }).eq('id', visit.id);\r\n    }\r\n\r\n    async function handleBatchOrderServices() {\r\n        if (!activeVisit || pendingServices.length === 0) return;\r\n        setLoading(true);\r\n\r\n        const servicesToInsert = pendingServices.map(type => ({\r\n            visit_id: activeVisit.id,\r\n            service_type: type,\r\n            status: 'Pending'\r\n        }));\r\n\r\n        const { error } = await supabase.from('services').insert(servicesToInsert);\r\n\r\n        if (!error) {\r\n            // FORCE UPDATE status to 'Waiting for Service' regardless of current status (Add-on logic)\r\n            await supabase.from('visits').update({ status: 'Waiting for Service', reason: examNote.reason }).eq('id', activeVisit.id);\r\n            setMessage({ type: 'success', text: `Đã chỉ định ${pendingServices.length} dịch vụ thành công!` });\r\n            setPendingServices([]);\r\n            setActiveVisit(null);\r\n        } else {\r\n            setMessage({ type: 'error', text: 'Có lỗi xảy ra khi lưu chỉ định.' });\r\n        }\r\n        setLoading(false);\r\n    }\r\n\r\n    async function handleCancelVisit() {\r\n        if (!activeVisit) return;\r\n        if (!confirm('Bạn có chắc đánh dấu bệnh nhân này là Vắng mặt/Hủy?')) return;\r\n\r\n        const { error } = await supabase.from('visits').update({ status: 'Missed' }).eq('id', activeVisit.id);\r\n        if (!error) {\r\n            setMessage({ type: 'success', text: 'Đã hủy/đánh dấu vắng mặt thành công.' });\r\n            setActiveVisit(null);\r\n        }\r\n    }\r\n\r\n    async function saveExamData() {\r\n        if (!activeVisit) return false;\r\n        try {\r\n            // 1. Update Visit Info\r\n            const { error: visitError } = await supabase.from('visits').update({\r\n                reason: examNote.reason,\r\n                conclusion: examNote.conclusion,\r\n                doctor_by: selectedDoctor\r\n            }).eq('id', activeVisit.id);\r\n\r\n            if (visitError) throw visitError;\r\n\r\n            // 2. Save Prescription\r\n            if (prescriptions.length > 0) {\r\n                // Check if exists first because 'visit_id' does not have UNIQUE constraint in DB\r\n                const { data: existingPresc } = await supabase\r\n                    .from('prescriptions')\r\n                    .select('id')\r\n                    .eq('visit_id', activeVisit.id)\r\n                    .single();\r\n\r\n                let prescError;\r\n                if (existingPresc) {\r\n                    const { error } = await supabase\r\n                        .from('prescriptions')\r\n                        .update({ medication_data: prescriptions })\r\n                        .eq('visit_id', activeVisit.id);\r\n                    prescError = error;\r\n                } else {\r\n                    const { error } = await supabase\r\n                        .from('prescriptions')\r\n                        .insert([{\r\n                            visit_id: activeVisit.id,\r\n                            medication_data: prescriptions\r\n                        }]);\r\n                    prescError = error;\r\n                }\r\n\r\n                if (prescError) throw prescError;\r\n            }\r\n\r\n            return true;\r\n        } catch (err: any) {\r\n            setMessage({ type: 'error', text: 'Lỗi lưu dữ liệu: ' + err.message });\r\n            return false;\r\n        }\r\n    }\r\n\r\n    async function handleSaveExam() {\r\n        if (!selectedDoctor) {\r\n            setMessage({ type: 'error', text: 'Vui lòng chọn bác sĩ.' });\r\n            return;\r\n        }\r\n        setLoading(true);\r\n        const success = await saveExamData();\r\n        if (success) {\r\n            setMessage({ type: 'success', text: 'Đã lưu dữ liệu khám bệnh.' });\r\n        }\r\n        setLoading(false);\r\n    }\r\n\r\n    async function handlePrintPrescription() {\r\n        if (!selectedDoctor) {\r\n            setMessage({ type: 'error', text: 'Vui lòng chọn bác sĩ.' });\r\n            return;\r\n        }\r\n        setLoading(true);\r\n        // Save first to ensure data is consistent\r\n        const success = await saveExamData();\r\n        if (success) {\r\n            // TODO: Open Print Window / Generate PDF\r\n            // For now, simple alert or window.print() placeholder\r\n            window.open(`/print/prescription/${activeVisit?.id}`, '_blank');\r\n        }\r\n        setLoading(false);\r\n    }\r\n\r\n    async function handleFinishExam() {\r\n        if (!activeVisit) return;\r\n        if (!confirm('Hoàn tất lượt khám và chuyển bệnh nhân sang thanh toán?')) return;\r\n\r\n        setLoading(true);\r\n        const success = await saveExamData();\r\n        if (success) {\r\n            const { error } = await supabase.from('visits').update({\r\n                status: 'Ready for Payment'\r\n            }).eq('id', activeVisit.id);\r\n\r\n            if (!error) {\r\n                setMessage({ type: 'success', text: 'Đã hoàn tất lượt khám. Chuyển thanh toán.' });\r\n                setActiveVisit(null);\r\n            } else {\r\n                setMessage({ type: 'error', text: 'Lỗi cập nhật trạng thái.' });\r\n            }\r\n        }\r\n        setLoading(false);\r\n    }\r\n\r\n    async function handleMarkMissed() {\r\n        if (!activeVisit) return;\r\n        await supabase.from('visits').update({ status: 'Missed' }).eq('id', activeVisit.id);\r\n        setActiveVisit(null);\r\n        setMessage({ type: 'success', text: 'Đã đánh dấu bệnh nhân vắng mặt.' });\r\n    }\r\n\r\n    // Auto-dismiss message after 3 seconds\r\n    useEffect(() => {\r\n        if (message) {\r\n            const timer = setTimeout(() => setMessage(null), 3000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [message]);\r\n\r\n    return (\r\n        <div className=\"container mx-auto p-4 flex flex-col h-screen max-h-screen overflow-hidden relative\">\r\n            <header className=\"mb-4 flex justify-between items-center shrink-0\">\r\n                <h1 className=\"text-2xl font-bold text-primary flex items-center gap-2\">\r\n                    <Stethoscope /> Phân hệ Bác sĩ\r\n                </h1>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <label className=\"text-sm font-medium\">Bác sĩ khám:</label>\r\n                    <select\r\n                        className=\"border p-1.5 rounded-md bg-white text-sm\"\r\n                        value={selectedDoctor}\r\n                        onChange={(e) => setSelectedDoctor(e.target.value)}\r\n                    >\r\n                        <option value=\"\">-- Chọn bác sĩ --</option>\r\n                        {doctors.map(d => (\r\n                            <option key={d.id} value={d.name}>{d.name}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"flex gap-4 flex-1 overflow-hidden\">\r\n                {/* Left Sidebar: Queues */}\r\n                <div className=\"w-80 flex flex-col gap-4 overflow-y-auto shrink-0 pr-2\">\r\n                    <div className=\"bg-white rounded-lg shadow-sm border p-3\">\r\n                        <h3 className=\"text-sm font-bold mb-2 text-gray-500 uppercase flex items-center gap-1\">\r\n                            <Users size={14} /> Hàng đợi khám\r\n                        </h3>\r\n\r\n                        {/* My Active Patients List */}\r\n                        {selectedDoctor && (\r\n                            <QueueList\r\n                                status=\"Examing\"\r\n                                title=\"Đang khám (Của tôi)\"\r\n                                onSelect={handleSelectPatient}\r\n                                filterDoctor={selectedDoctor} // We need to add this prop to QueueList\r\n                            />\r\n                        )}\r\n\r\n                        <div className=\"mt-4\">\r\n                            <QueueList\r\n                                status=\"Waiting for Exam\"\r\n                                title=\"Khám mới\"\r\n                                onSelect={handleSelectPatient}\r\n                            />\r\n                        </div>\r\n                        <div className=\"mt-4\">\r\n                            <QueueList\r\n                                status=\"Return to Doctor\"\r\n                                title=\"Quay lại (Có KQ)\"\r\n                                onSelect={handleSelectPatient}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"bg-white rounded-lg shadow-sm border p-3 mt-auto\">\r\n                        <h3 className=\"text-sm font-bold mb-2 text-gray-500 uppercase flex items-center gap-1\">\r\n                            <History size={14} /> Bệnh nhân vừa khám\r\n                        </h3>\r\n                        <div className=\"flex-1 overflow-y-auto min-h-0\">\r\n                            {selectedDoctor ? (\r\n                                <QueueList\r\n                                    status=\"Ready for Payment\"\r\n                                    title=\"Chờ t.toán (Vừa xong)\"\r\n                                    onSelect={handleSelectPatient}\r\n                                    filterDoctor={selectedDoctor}\r\n                                />\r\n                            ) : (\r\n                                <p className=\"text-xs text-gray-400 text-center italic mt-4\">Chọn bác sĩ để xem lịch sử</p>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Main Content: Examination */}\r\n                <div className=\"flex-1 bg-white rounded-xl border shadow-sm flex flex-col overflow-hidden\">\r\n                    {/* ... if no activeVisit ... */}\r\n                    {!activeVisit ? (\r\n                        // ...\r\n                        <div className=\"flex-1 flex flex-col items-center justify-center text-gray-400 bg-gray-50/50\">\r\n                            <Stethoscope size={48} strokeWidth={1} className=\"mb-2\" />\r\n                            <p>Chọn một bệnh nhân từ hàng đợi để bắt đầu khám</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"flex flex-col h-full\">\r\n                            {/* ... header activeVisit ... */}\r\n                            <div className=\"p-4 border-b flex justify-between items-center bg-blue-50/30\">\r\n                                <div>\r\n                                    <h2 className=\"text-lg font-bold text-gray-800\">{activeVisit.patient?.full_name}</h2>\r\n                                    <div className=\"text-xs text-gray-500 flex gap-4\">\r\n                                        <span>CCCD: {activeVisit.patient?.cccd}</span>\r\n                                        <span>Tuổi: {activeVisit.patient?.dob ? new Date().getFullYear() - new Date(activeVisit.patient.dob).getFullYear() : 'N/A'}</span>\r\n                                        <span>GT: {activeVisit.patient?.gender}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex gap-2\">\r\n                                    <button onClick={handleMarkMissed} className=\"p-2 text-red-600 hover:bg-red-50 rounded-lg flex items-center gap-1 text-sm border border-red-100\">\r\n                                        <XCircle size={16} /> Vắng mặt\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setShowHistory(true)}\r\n                                        className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg flex items-center gap-1 text-sm border border-blue-100\"\r\n                                    >\r\n                                        <History size={16} /> Xem bệnh sử\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* ... Content ... */}\r\n                            <div className=\"flex-1 overflow-y-auto p-4 space-y-6\">\r\n                                {/* ... Note ... */}\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-bold text-gray-600 mb-1\">Lý do khám / Triệu chứng</label>\r\n                                        <textarea\r\n                                            className=\"w-full border rounded-lg p-3 h-24 focus:ring-2 focus:ring-primary outline-none\"\r\n                                            value={examNote.reason}\r\n                                            onChange={e => setExamNote({ ...examNote, reason: e.target.value })}\r\n                                        />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-bold text-gray-600 mb-1\">Kết luận / Chẩn đoán</label>\r\n                                        <textarea\r\n                                            className=\"w-full border rounded-lg p-3 h-24 focus:ring-2 focus:ring-primary outline-none\"\r\n                                            value={examNote.conclusion}\r\n                                            onChange={e => setExamNote({ ...examNote, conclusion: e.target.value })}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* ... Service Orders ... */}\r\n                                <div className=\"bg-gray-50 rounded-lg p-4 border border-dashed border-gray-300\">\r\n                                    <h3 className=\"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2\">\r\n                                        <Beaker size={16} /> Chỉ định cận lâm sàng\r\n                                    </h3>\r\n                                    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\r\n                                        {availableServices.length === 0 && <p className=\"text-sm text-gray-500 italic col-span-3\">Đang tải danh sách dịch vụ...</p>}\r\n                                        {availableServices.map((service) => (\r\n                                            <label key={service} className=\"flex items-center gap-2 bg-white border p-3 rounded-lg cursor-pointer hover:border-primary transition-colors\">\r\n                                                <input\r\n                                                    type=\"checkbox\"\r\n                                                    className=\"w-4 h-4 text-primary rounded focus:ring-primary\"\r\n                                                    checked={pendingServices.includes(service)}\r\n                                                    onChange={(e) => {\r\n                                                        if (e.target.checked) setPendingServices([...pendingServices, service]);\r\n                                                        else setPendingServices(pendingServices.filter(s => s !== service));\r\n                                                    }}\r\n                                                />\r\n                                                <span className=\"text-sm font-medium\">{service}</span>\r\n                                            </label>\r\n                                        ))}\r\n                                    </div>\r\n                                    {pendingServices.length > 0 && (\r\n                                        <div className=\"mt-3 flex justify-end\">\r\n                                            <button\r\n                                                onClick={handleBatchOrderServices}\r\n                                                disabled={loading}\r\n                                                className=\"bg-primary text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-600 transition-all flex items-center gap-2 shadow-sm\"\r\n                                            >\r\n                                                <Plus size={16} /> Chỉ định {pendingServices.length} dịch vụ đã chọn\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* ... Completed Services ... */}\r\n                                {completedServices.length > 0 && (\r\n                                    <div className=\"bg-green-50 rounded-lg p-4 border border-green-200 animate-in fade-in slide-in-from-bottom-5\">\r\n                                        <h3 className=\"text-sm font-bold text-green-800 mb-3 flex items-center gap-2\">\r\n                                            <CheckCircle size={16} /> Kết quả Cận lâm sàng\r\n                                        </h3>\r\n                                        <div className=\"grid grid-cols-1 gap-4\">\r\n                                            {completedServices.map(service => (\r\n                                                <div key={service.id} className=\"bg-white p-4 rounded-lg border border-green-100 shadow-sm flex gap-4\">\r\n                                                    {service.image_url && (\r\n                                                        <div className=\"shrink-0 flex flex-col items-center gap-1\">\r\n                                                            <a href={service.image_url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"block\">\r\n                                                                <img\r\n                                                                    src={service.image_url}\r\n                                                                    alt=\"Kết quả\"\r\n                                                                    className=\"w-32 h-32 object-cover rounded-lg border hover:opacity-90 transition-opacity bg-gray-100\"\r\n                                                                    onError={(e) => {\r\n                                                                        (e.target as HTMLImageElement).src = 'https://placehold.co/150?text=Lỗi+Ảnh';\r\n                                                                        (e.target as HTMLImageElement).style.objectFit = 'contain';\r\n                                                                    }}\r\n                                                                />\r\n                                                            </a>\r\n                                                            <a href={service.image_url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-[10px] text-blue-600 hover:underline flex items-center gap-1\">\r\n                                                                <ExternalLink size={10} /> Xem ảnh gốc\r\n                                                            </a>\r\n                                                        </div>\r\n                                                    )}\r\n                                                    <div className=\"flex-1\">\r\n                                                        <div className=\"flex justify-between items-start mb-2\">\r\n                                                            <span className=\"font-bold text-gray-800\">{service.service_type}</span>\r\n                                                            <span className=\"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full border border-green-200\">\r\n                                                                Thực hiện bởi: {service.tech_by}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                        <p className=\"text-sm text-gray-700 whitespace-pre-wrap bg-gray-50 p-2 rounded border border-gray-100\">\r\n                                                            {service.result_text || 'Chưa có mô tả kết quả.'}\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* ... Prescriptions ... */}\r\n                                <div>\r\n                                    <h3 className=\"text-sm font-bold text-gray-700 mb-2 flex items-center gap-2\">\r\n                                        <FileText size={16} /> Kê đơn thuốc\r\n                                    </h3>\r\n                                    <div className=\"space-y-2\">\r\n                                        {prescriptions.map((p, i) => (\r\n                                            <div key={i} className=\"flex gap-2 items-center bg-white p-2 border rounded-lg animate-in slide-in-from-left-2 duration-200\">\r\n                                                <input\r\n                                                    list=\"meds\"\r\n                                                    placeholder=\"Tên thuốc...\"\r\n                                                    className=\"flex-[2] border-none focus:ring-0 text-sm\"\r\n                                                    value={p.name}\r\n                                                    onChange={e => {\r\n                                                        const newP = [...prescriptions];\r\n                                                        newP[i].name = e.target.value;\r\n                                                        setPrescriptions(newP);\r\n                                                    }}\r\n                                                />\r\n                                                <input\r\n                                                    placeholder=\"Liều dùng (VD: 2v/ngày)\"\r\n                                                    className=\"flex-[1] border-none focus:ring-0 text-sm italic text-gray-500\"\r\n                                                    value={p.dose}\r\n                                                    onChange={e => {\r\n                                                        const newP = [...prescriptions];\r\n                                                        newP[i].dose = e.target.value;\r\n                                                        setPrescriptions(newP);\r\n                                                    }}\r\n                                                />\r\n                                                <input\r\n                                                    placeholder=\"Số lượng\"\r\n                                                    className=\"w-20 border-none focus:ring-0 text-sm text-center font-bold\"\r\n                                                    value={p.qty}\r\n                                                    onChange={e => {\r\n                                                        const newP = [...prescriptions];\r\n                                                        newP[i].qty = e.target.value;\r\n                                                        setPrescriptions(newP);\r\n                                                    }}\r\n                                                />\r\n                                                <button onClick={() => setPrescriptions(prescriptions.filter((_, idx) => idx !== i))} className=\"p-1 text-gray-300 hover:text-red-500\">\r\n                                                    <XCircle size={16} />\r\n                                                </button>\r\n                                            </div>\r\n                                        ))}\r\n                                        <button\r\n                                            onClick={() => setPrescriptions([...prescriptions, { name: '', dose: '', qty: '' }])}\r\n                                            className=\"text-primary text-sm flex items-center gap-1 hover:underline p-1\"\r\n                                        >\r\n                                            <Plus size={14} /> Thêm thuốc\r\n                                        </button>\r\n                                        <datalist id=\"meds\">\r\n                                            {availableMedications.map(m => (\r\n                                                <option key={m.id} value={m.name} />\r\n                                            ))}\r\n                                        </datalist>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* ... Footer Actions ... */}\r\n                            <div className=\"p-4 border-t bg-gray-50 flex justify-between items-center shrink-0\">\r\n                                <div className=\"flex gap-2\">\r\n                                    <button\r\n                                        onClick={handleSaveExam}\r\n                                        disabled={loading}\r\n                                        className=\"bg-white border border-gray-200 px-4 py-2 rounded-lg hover:border-primary hover:text-primary transition-all flex items-center gap-2\"\r\n                                    >\r\n                                        <Save size={18} /> Lưu Nháp\r\n                                    </button>\r\n                                </div>\r\n                                <div className=\"flex gap-3\">\r\n                                    <button\r\n                                        onClick={handlePrintPrescription}\r\n                                        disabled={loading}\r\n                                        className=\"bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-lg hover:bg-gray-100 transition-all flex items-center gap-2 shadow-sm\"\r\n                                    >\r\n                                        <Printer size={18} /> In Đơn Thuốc\r\n                                    </button>\r\n\r\n                                    <button\r\n                                        onClick={handleFinishExam}\r\n                                        disabled={loading || !selectedDoctor}\r\n                                        className=\"bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-all flex items-center gap-2 shadow-md shadow-blue-200 disabled:opacity-50\"\r\n                                    >\r\n                                        <CheckCircle size={18} /> Hoàn tất Khám\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {message && (\r\n                <div\r\n                    className={`fixed top-4 right-4 p-4 rounded-xl shadow-lg flex items-center gap-3 animate-in slide-in-from-top-5 z-50 cursor-pointer ${message.type === 'success' ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`}\r\n                    onClick={() => setMessage(null)}\r\n                >\r\n                    {message.type === 'success' ? <CheckCircle size={20} /> : <AlertCircle size={20} />}\r\n                    <div className=\"flex-1\">\r\n                        <p className=\"font-medium\">{message.text}</p>\r\n                        <p className=\"text-xs opacity-80 mt-1\">Bấm để đóng</p>\r\n                    </div>\r\n                    <XCircle size={18} className=\"opacity-50 hover:opacity-100\" />\r\n                </div>\r\n            )}\r\n\r\n            {showHistory && activeVisit?.patient && (\r\n                <PatientHistoryModal\r\n                    patient={activeVisit.patient as any} // Cast safely as we know it's a patient object\r\n                    onClose={() => setShowHistory(false)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n// Minimalist alert icon for footer\r\nfunction AlertCircle({ size }: { size: number }) {\r\n    return <XCircle size={size} />;\r\n}\r\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M15 3h6v6', key: '1q9fwt' }],\n  ['path', { d: 'M10 14 21 3', key: 'gplh6r' }],\n  ['path', { d: 'M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6', key: 'a6xqqp' }],\n];\n\n/**\n * @component @name ExternalLink\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTUgM2g2djYiIC8+CiAgPHBhdGggZD0iTTEwIDE0IDIxIDMiIC8+CiAgPHBhdGggZD0iTTE4IDEzdjZhMiAyIDAgMCAxLTIgMkg1YTIgMiAwIDAgMS0yLTJWOGEyIDIgMCAwIDEgMi0yaDYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/external-link\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ExternalLink = createLucideIcon('ExternalLink', __iconNode);\n\nexport default ExternalLink;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2',\n      key: '143wyd',\n    },\n  ],\n  ['path', { d: 'M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6', key: '1itne7' }],\n  ['rect', { x: '6', y: '14', width: '12', height: '8', rx: '1', key: '1ue0tg' }],\n];\n\n/**\n * @component @name Printer\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNiAxOEg0YTIgMiAwIDAgMS0yLTJ2LTVhMiAyIDAgMCAxIDItMmgxNmEyIDIgMCAwIDEgMiAydjVhMiAyIDAgMCAxLTIgMmgtMiIgLz4KICA8cGF0aCBkPSJNNiA5VjNhMSAxIDAgMCAxIDEtMWgxMGExIDEgMCAwIDEgMSAxdjYiIC8+CiAgPHJlY3QgeD0iNiIgeT0iMTQiIHdpZHRoPSIxMiIgaGVpZ2h0PSI4IiByeD0iMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/printer\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Printer = createLucideIcon('Printer', __iconNode);\n\nexport default Printer;\n"],"names":[],"mappings":"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","ignoreList":[1,2]}