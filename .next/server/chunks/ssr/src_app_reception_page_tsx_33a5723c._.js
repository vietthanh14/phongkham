module.exports=[99690,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(10849),e=a.i(87532),f=a.i(17371),g=a.i(4720),h=a.i(16201),i=a.i(92e3),j=a.i(2927),k=a.i(33508),l=a.i(70106);let m=(0,l.default)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);var n=a.i(3858),o=a.i(35126);let p=(0,l.default)("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);function q({visit:a,onClose:e,onConfirm:f}){let[g,h]=(0,c.useState)(!0),[i,j]=(0,c.useState)([]),[l,q]=(0,c.useState)(0);async function r(){h(!0);let b=[],c=0,{data:e}=await d.supabase.from("service_catalog").select("name, price").eq("is_active",!0),f=new Map((e||[]).map(a=>[a.name,Number(a.price)])),g=a=>f.has(a)?f.get(a)||0:5e4*("Khám bệnh"===a||"General Exam"===a),i=g("Khám bệnh");b.push({name:"Khám bệnh",qty:1,price:i,type:"service"}),c+=i;let{data:k}=await d.supabase.from("services").select("service_type").eq("visit_id",a.id).neq("status","Skipped");k&&k.forEach(a=>{let d=g(a.service_type);b.push({name:a.service_type,qty:1,price:d,type:"service"}),c+=d});let{data:l}=await d.supabase.from("prescriptions").select("*").eq("visit_id",a.id),{data:m}=await d.supabase.from("medications").select("name, price"),n=new Map((m||[]).map(a=>[a.name,Number(a.price)]));l&&l.forEach(a=>{let d=a.medication_data;Array.isArray(d)&&d.forEach(a=>{let d=n.get(a.name)||0,e=parseInt(a.qty)||0,f=d*e;b.push({name:a.name,qty:e,price:f,type:"medication"}),c+=f})}),j(b),q(c),h(!1)}return(0,c.useEffect)(()=>{r()},[a]),(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg animate-in zoom-in-95 duration-200",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,b.jsxs)("h3",{className:"text-xl font-bold flex items-center gap-2",children:[(0,b.jsx)(m,{className:"text-green-600"})," Thanh toán Viện phí"]}),(0,b.jsx)("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:(0,b.jsx)(k.X,{size:24})})]}),(0,b.jsx)("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:g?(0,b.jsx)("div",{className:"text-center py-8 text-gray-400",children:"Đang tính toán..."}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-700 mb-2",children:"Thông tin hành chính"}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Bệnh nhân:"})," ",a.patient?.full_name]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Mã lượt khám:"})," ",a.id.slice(0,8),"..."]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-700 mb-2",children:"Chi tiết dịch vụ & Thuốc"}),(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{className:"bg-gray-100 text-gray-600",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"p-2 text-left",children:"Nội dung"}),(0,b.jsx)("th",{className:"p-2 text-center",children:"SL"}),(0,b.jsx)("th",{className:"p-2 text-right",children:"Thành tiền"})]})}),(0,b.jsx)("tbody",{className:"divide-y",children:i.map((a,c)=>(0,b.jsxs)("tr",{children:[(0,b.jsxs)("td",{className:"p-2 flex items-center gap-2",children:["service"===a.type?(0,b.jsx)(o.Stethoscope,{size:14,className:"text-blue-500"}):(0,b.jsx)(n.Pill,{size:14,className:"text-purple-500"}),a.name]}),(0,b.jsxs)("td",{className:"p-2 text-center text-gray-500",children:["x",a.qty]}),(0,b.jsx)("td",{className:"p-2 text-right font-medium",children:a.price>0?a.price.toLocaleString("vi-VN")+" ₫":(0,b.jsx)("span",{className:"text-xs text-gray-500 italic",children:"Kê đơn (tự túc)"})})]},c))}),(0,b.jsx)("tfoot",{className:"bg-green-50 font-bold text-green-800",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{colSpan:2,className:"p-3 text-right",children:"TỔNG CỘNG:"}),(0,b.jsxs)("td",{className:"p-3 text-right text-lg",children:[l.toLocaleString("vi-VN")," ₫"]})]})})]})})]})]})}),(0,b.jsxs)("div",{className:"p-4 border-t flex justify-end gap-3 bg-gray-50 rounded-b-xl",children:[(0,b.jsx)("button",{onClick:e,className:"px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-lg",children:"Bỏ qua"}),(0,b.jsxs)("button",{onClick:f,disabled:g,className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 shadow-md flex items-center gap-2 font-medium",children:[(0,b.jsx)(p,{size:20})," Xác nhận Đã thu tiền"]})]})]})})}function r(){let[a,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(null);async function A(){let{data:a,error:b}=await d.supabase.from("staff").select("*").eq("role","Receptionist").eq("is_active",!0);a&&k(a)}async function B(a){if(!confirm(`Bạn c\xf3 chắc muốn hủy lượt kh\xe1m của ${a.patient?.full_name}?`))return;let{error:b}=await d.supabase.from("visits").update({status:"Cancelled"}).eq("id",a.id);b?x({type:"error",text:"Lỗi khi hủy lượt khám."}):x({type:"success",text:"Đã hủy lượt khám thành công."})}async function C(a){if(!confirm(`Kh\xf4i phục lượt kh\xe1m cho ${a.patient?.full_name}?`))return;let{error:b}=await d.supabase.from("visits").update({status:"Waiting for Exam"}).eq("id",a.id);b?x({type:"error",text:"Lỗi khôi phục."}):x({type:"success",text:"Đã khôi phục thành công."})}async function D(){if(!n)return;v(!0),x(null);let{data:a,error:b}=await d.supabase.from("patients").select("*").eq("cccd",n).single();a?(r(a),t(!1)):(r({cccd:n}),t(!0),x({type:"error",text:"Bệnh nhân chưa có trong hệ thống. Vui lòng nhập thông tin mới."})),v(!1)}async function E(a){if(a.preventDefault(),!l)return void x({type:"error",text:"Vui lòng chọn nhân viên lễ tân trước."});v(!0);try{let a=p?.id;if(s){let{data:b,error:c}=await d.supabase.from("patients").insert([p]).select().single();if(c)throw c;a=b.id}else if(a){let{data:b}=await d.supabase.from("visits").select("id, status").eq("patient_id",a).in("status",["Waiting for Exam","Examing","Waiting for Service","Return to Doctor","Ready for Payment"]);if(b&&b.length>0)throw Error(`Bệnh nh\xe2n n\xe0y đang c\xf3 lượt kh\xe1m (Trạng th\xe1i: ${b[0].status}). Vui l\xf2ng kiểm tra lại.`)}let{error:b}=await d.supabase.from("visits").insert([{patient_id:a,reception_by:l,status:"Waiting for Exam"}]);if(b)throw b;x({type:"success",text:"Đã đăng ký và đưa vào hàng đợi khám thành công!"}),F()}catch(a){x({type:"error",text:a.message})}finally{v(!1)}}function F(){o(""),r(null),t(!1)}return(0,c.useEffect)(()=>{A()},[]),(0,b.jsxs)("div",{className:"container mx-auto p-4 max-w-4xl",children:[(0,b.jsxs)("header",{className:"mb-8 flex justify-between items-center",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-primary",children:"Phân hệ Lễ tân"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Nhân viên trực:"}),(0,b.jsxs)("select",{className:"border p-2 rounded-md bg-white",value:l,onChange:a=>m(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"-- Chọn tên --"}),a.map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id))]})]})]}),(0,b.jsxs)("section",{className:"bg-white p-6 rounded-xl shadow-sm border mb-6",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[(0,b.jsx)(e.Search,{size:20,className:"text-primary"})," Tiêp nhận bệnh nhân"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",placeholder:"Nhập số CCCD...",className:"flex-1 border p-3 rounded-lg focus:ring-2 focus:ring-primary outline-none",value:n,onChange:a=>o(a.target.value)}),(0,b.jsx)("button",{onClick:D,disabled:u,className:"bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50",children:u?"Đang tìm...":"Tìm kiếm"})]})]}),p&&(0,b.jsxs)("form",{onSubmit:E,className:"bg-white p-6 rounded-xl shadow-sm border animate-in fade-in duration-300",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[s?(0,b.jsx)(f.UserPlus,{size:20,className:"text-success"}):(0,b.jsx)(g.FileText,{size:20,className:"text-primary"}),s?"Đăng ký bệnh nhân mới":"Thông tin bệnh nhân"]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Số CCCD"}),(0,b.jsx)("input",{type:"text",value:p.cccd||"",readOnly:!0,className:"w-full p-2 border rounded bg-gray-50"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Họ tên *"}),(0,b.jsx)("input",{type:"text",required:!0,className:"w-full p-2 border rounded",value:p.full_name||"",onChange:a=>r({...p,full_name:a.target.value}),readOnly:!s})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Ngày sinh"}),(0,b.jsx)("input",{type:"date",className:"w-full p-2 border rounded",value:p.dob||"",onChange:a=>r({...p,dob:a.target.value}),readOnly:!s})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Giới tính"}),(0,b.jsxs)("select",{className:"w-full p-2 border rounded",value:p.gender||"",onChange:a=>r({...p,gender:a.target.value}),disabled:!s,children:[(0,b.jsx)("option",{value:"",children:"Chọn..."}),(0,b.jsx)("option",{value:"Nam",children:"Nam"}),(0,b.jsx)("option",{value:"Nữ",children:"Nữ"}),(0,b.jsx)("option",{value:"Khác",children:"Khác"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Số điện thoại"}),(0,b.jsx)("input",{type:"text",className:"w-full p-2 border rounded",value:p.phone||"",onChange:a=>r({...p,phone:a.target.value}),readOnly:!s})]}),(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Địa chỉ"}),(0,b.jsx)("input",{type:"text",className:"w-full p-2 border rounded",value:p.address||"",onChange:a=>r({...p,address:a.target.value}),readOnly:!s})]})]}),(0,b.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:F,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Hủy"}),(0,b.jsx)("button",{type:"submit",disabled:u,className:"bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2",children:u?"Đang xử lý...":s?"Đăng ký & Khám":"Vào hàng đợi khám"})]})]}),w&&(0,b.jsxs)("div",{className:`mt-4 p-4 rounded-lg flex items-center gap-3 ${"success"===w.type?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:["success"===w.type?(0,b.jsx)(h.CheckCircle,{size:20}):(0,b.jsx)(i.AlertCircle,{size:20}),(0,b.jsx)("p",{children:w.text})]}),(0,b.jsxs)("div",{className:"mt-12 grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsx)(j.default,{status:"Waiting for Exam",title:"Hàng đợi Chờ khám",onCancel:B}),(0,b.jsx)(j.default,{status:"Ready for Payment",title:"Chờ Thanh toán",onSelect:a=>z(a)}),(0,b.jsx)(j.default,{status:"Missed",title:"Vắng mặt / Đã hủy",onRestore:C})]}),y&&(0,b.jsx)(q,{visit:y,onClose:()=>z(null),onConfirm:()=>G(y)})]});async function G(a){v(!0);let{error:b}=await d.supabase.from("visits").update({status:"Done"}).eq("id",a.id);b?x({type:"error",text:"Lỗi xử lý thanh toán."}):(x({type:"success",text:`Đ\xe3 thanh to\xe1n xong cho ${a.patient?.full_name}.`}),z(null)),v(!1)}}a.s(["default",()=>r],99690)}];

//# sourceMappingURL=src_app_reception_page_tsx_33a5723c._.js.map